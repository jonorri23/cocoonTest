<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ¦‹ Cocoon Metamorphosis</title>
  
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;500&display=swap" rel="stylesheet">
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    :root {
      --caterpillar-body: #2D1B4E;
      --caterpillar-accent: #64FFDA;
      --caterpillar-highlight: #B084CC;
      --caterpillar-dark: #1A0F2E;
      --bg-dark: #0A0612;
      --bg-glow: #1A0F2E;
    }
    
    body {
      font-family: 'Cormorant Garamond', Georgia, serif;
      background: radial-gradient(ellipse at center, var(--bg-glow) 0%, var(--bg-dark) 70%);
      min-height: 100vh;
      overflow: hidden;
    }
    
    .container {
      position: relative;
      width: 100%;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    /* ğŸŒŒ BACKGROUND PARTICLES */
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    
    .bg-particles {
      position: absolute;
      inset: 0;
      pointer-events: none;
      overflow: hidden;
    }
    
    .bg-particle {
      position: absolute;
      border-radius: 50%;
      animation: float-particle 4s ease-in-out infinite;
    }
    
    @keyframes float-particle {
      0%, 100% { transform: translateY(0); opacity: 0.2; }
      50% { transform: translateY(-20px); opacity: 0.5; }
    }
    
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    /* ğŸ› CATERPILLAR */
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    
    .caterpillar-container {
      position: absolute;
      z-index: 10;
      width: 100%;
      max-width: 450px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: opacity 0.8s ease, transform 0.8s ease;
    }
    
    .caterpillar-container.hidden {
      opacity: 0;
      transform: scale(0.5);
      pointer-events: none;
    }
    
    .caterpillar-svg {
      width: 100%;
      overflow: visible;
    }
    
    /* Segment animation */
    .segment {
      animation: inchworm 0.8s ease-in-out infinite;
      transform-origin: center bottom;
    }
    
    .segment:nth-child(1) { animation-delay: 0s; }
    .segment:nth-child(2) { animation-delay: 0.08s; }
    .segment:nth-child(3) { animation-delay: 0.16s; }
    .segment:nth-child(4) { animation-delay: 0.24s; }
    .segment:nth-child(5) { animation-delay: 0.32s; }
    .segment:nth-child(6) { animation-delay: 0.40s; }
    .segment:nth-child(7) { animation-delay: 0.48s; }
    
    @keyframes inchworm {
      0%, 100% { transform: translateY(0) scaleY(1); }
      50% { transform: translateY(-8px) scaleY(0.9); }
    }
    
    /* Antenna wiggle */
    .antenna {
      animation: wiggle 1.5s ease-in-out infinite;
      transform-origin: bottom center;
    }
    
    .antenna:nth-child(2) {
      animation-delay: 0.2s;
    }
    
    @keyframes wiggle {
      0%, 100% { transform: rotate(0deg); }
      25% { transform: rotate(-5deg); }
      75% { transform: rotate(5deg); }
    }
    
    /* Curling animation */
    .caterpillar-container.curling .segment {
      animation: curl 1.2s ease-in-out forwards;
    }
    
    .caterpillar-container.curling .segment:nth-child(1) { animation-delay: 0.6s; }
    .caterpillar-container.curling .segment:nth-child(2) { animation-delay: 0.5s; }
    .caterpillar-container.curling .segment:nth-child(3) { animation-delay: 0.4s; }
    .caterpillar-container.curling .segment:nth-child(4) { animation-delay: 0.3s; }
    .caterpillar-container.curling .segment:nth-child(5) { animation-delay: 0.2s; }
    .caterpillar-container.curling .segment:nth-child(6) { animation-delay: 0.1s; }
    .caterpillar-container.curling .segment:nth-child(7) { animation-delay: 0s; }
    
    @keyframes curl {
      to {
        transform: translate(var(--curl-x), var(--curl-y)) scale(0.7);
        opacity: 0.8;
      }
    }
    
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    /* ğŸŒ€ SILK SPINNER */
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    
    .silk-spinner {
      position: absolute;
      z-index: 15;
      width: 300px;
      height: 300px;
      opacity: 0;
      transition: opacity 0.5s ease;
      pointer-events: none;
    }
    
    .silk-spinner.active {
      opacity: 1;
    }
    
    .silk-thread {
      stroke-dasharray: 200;
      stroke-dashoffset: 200;
      animation: spin-silk 2s ease-in-out infinite;
    }
    
    .silk-thread:nth-child(1) { animation-delay: 0s; }
    .silk-thread:nth-child(2) { animation-delay: 0.15s; }
    .silk-thread:nth-child(3) { animation-delay: 0.3s; }
    .silk-thread:nth-child(4) { animation-delay: 0.45s; }
    .silk-thread:nth-child(5) { animation-delay: 0.6s; }
    .silk-thread:nth-child(6) { animation-delay: 0.75s; }
    .silk-thread:nth-child(7) { animation-delay: 0.9s; }
    .silk-thread:nth-child(8) { animation-delay: 1.05s; }
    .silk-thread:nth-child(9) { animation-delay: 1.2s; }
    .silk-thread:nth-child(10) { animation-delay: 1.35s; }
    .silk-thread:nth-child(11) { animation-delay: 1.5s; }
    .silk-thread:nth-child(12) { animation-delay: 1.65s; }
    
    @keyframes spin-silk {
      0% { stroke-dashoffset: 200; opacity: 0; }
      50% { stroke-dashoffset: 0; opacity: 0.8; }
      100% { stroke-dashoffset: 0; opacity: 0; }
    }
    
    .silk-mass {
      animation: grow-silk 2.5s ease-out forwards;
    }
    
    @keyframes grow-silk {
      from { r: 0; }
      to { r: 50; }
    }
    
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    /* ğŸ¥š 3D COCOON (CSS FALLBACK) */
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    
    .cocoon-3d-container {
      position: absolute;
      z-index: 5;
      opacity: 0;
      transform: scale(0.3);
      transition: opacity 1.5s ease, transform 1.5s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    
    .cocoon-3d-container.visible {
      opacity: 1;
      transform: scale(1);
    }
    
    #cocoon-canvas {
      width: 100vw;
      height: 100vh;
    }
    
    /* CSS fallback cocoon (shows if WebGL fails) */
    .cocoon-fallback {
      width: 180px;
      height: 280px;
      background: linear-gradient(
        180deg,
        var(--caterpillar-highlight) 0%,
        #ffffff 40%,
        var(--caterpillar-accent) 80%,
        var(--caterpillar-highlight) 100%
      );
      border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
      box-shadow: 
        0 0 60px var(--caterpillar-accent),
        inset 0 0 40px rgba(255, 255, 255, 0.3);
      animation: breathe 3s ease-in-out infinite, wobble 8s ease-in-out infinite;
      display: none; /* Hidden when WebGL works */
    }
    
    @keyframes breathe {
      0%, 100% { transform: scale(1) rotateY(0deg); }
      50% { transform: scale(1.03) rotateY(5deg); }
    }
    
    @keyframes wobble {
      0%, 100% { transform: rotateX(0deg) rotateZ(0deg); }
      25% { transform: rotateX(3deg) rotateZ(2deg); }
      75% { transform: rotateX(-3deg) rotateZ(-2deg); }
    }
    
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    /* âœ¨ EMERGENCE PARTICLES */
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    
    .emergence-particles {
      position: absolute;
      z-index: 20;
      pointer-events: none;
      opacity: 0;
    }
    
    .emergence-particles.active {
      opacity: 1;
    }
    
    .emergence-particle {
      position: absolute;
      border-radius: 50%;
      animation: emerge 1.5s ease-out forwards;
    }
    
    @keyframes emerge {
      0% {
        transform: translate(0, 0) scale(0);
        opacity: 0;
      }
      30% {
        opacity: 1;
      }
      100% {
        transform: translate(var(--tx), var(--ty)) scale(1);
        opacity: 0;
      }
    }
    
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    /* ğŸ“ STATUS TEXT */
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    
    .status-text {
      position: absolute;
      bottom: 10%;
      left: 50%;
      transform: translateX(-50%);
      z-index: 30;
      text-align: center;
    }
    
    .status-text p {
      font-size: 1.1rem;
      letter-spacing: 0.3em;
      text-transform: uppercase;
      color: var(--caterpillar-accent);
      text-shadow: 0 0 20px rgba(100, 255, 218, 0.4);
      animation: pulse-text 2s ease-in-out infinite;
    }
    
    @keyframes pulse-text {
      0%, 100% { opacity: 0.5; }
      50% { opacity: 1; }
    }
    
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    /* ğŸ”„ REPLAY BUTTON */
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    
    .replay-btn {
      position: absolute;
      top: 20px;
      right: 20px;
      z-index: 100;
      background: transparent;
      border: 1px solid var(--caterpillar-accent);
      color: var(--caterpillar-accent);
      padding: 10px 20px;
      font-family: 'Cormorant Garamond', serif;
      font-size: 0.9rem;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .replay-btn:hover {
      background: var(--caterpillar-accent);
      color: var(--bg-dark);
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Background Particles -->
    <div class="bg-particles" id="bgParticles"></div>
    
    <!-- Caterpillar -->
    <div class="caterpillar-container" id="caterpillar">
      <svg class="caterpillar-svg" viewBox="0 0 400 200">
        <defs>
          <linearGradient id="bodyGradient" x1="0%" y1="0%" x2="0%" y2="100%">
            <stop offset="0%" stop-color="#B084CC"/>
            <stop offset="50%" stop-color="#2D1B4E"/>
            <stop offset="100%" stop-color="#1A0F2E"/>
          </linearGradient>
          <filter id="glow" x="-50%" y="-50%" width="200%" height="200%">
            <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
            <feMerge>
              <feMergeNode in="coloredBlur"/>
              <feMergeNode in="SourceGraphic"/>
            </feMerge>
          </filter>
        </defs>
        
        <g filter="url(#glow)">
          <!-- Body Segments -->
          <ellipse class="segment" cx="80" cy="100" rx="18" ry="22" fill="url(#bodyGradient)" stroke="#64FFDA" stroke-width="1" style="--curl-x: 70px; --curl-y: 30px"/>
          <ellipse class="segment" cx="115" cy="100" rx="18" ry="22" fill="url(#bodyGradient)" stroke="#64FFDA" stroke-width="1" style="--curl-x: 50px; --curl-y: 45px"/>
          <ellipse class="segment" cx="150" cy="100" rx="18" ry="22" fill="url(#bodyGradient)" stroke="#64FFDA" stroke-width="1" style="--curl-x: 25px; --curl-y: 50px"/>
          <ellipse class="segment" cx="185" cy="100" rx="18" ry="22" fill="url(#bodyGradient)" stroke="#64FFDA" stroke-width="1" style="--curl-x: 0px; --curl-y: 50px"/>
          <ellipse class="segment" cx="220" cy="100" rx="18" ry="22" fill="url(#bodyGradient)" stroke="#64FFDA" stroke-width="1" style="--curl-x: -25px; --curl-y: 45px"/>
          <ellipse class="segment" cx="255" cy="100" rx="18" ry="22" fill="url(#bodyGradient)" stroke="#64FFDA" stroke-width="1" style="--curl-x: -50px; --curl-y: 30px"/>
          <ellipse class="segment" cx="290" cy="100" rx="18" ry="22" fill="url(#bodyGradient)" stroke="#64FFDA" stroke-width="1" style="--curl-x: -65px; --curl-y: 10px"/>
          
          <!-- Head -->
          <g class="head">
            <ellipse cx="325" cy="95" rx="22" ry="25" fill="#2D1B4E" stroke="#64FFDA" stroke-width="1.5"/>
            <!-- Eyes -->
            <circle cx="333" cy="88" r="6" fill="#1A0F2E"/>
            <circle cx="333" cy="88" r="3" fill="#64FFDA"/>
            <circle cx="317" cy="88" r="6" fill="#1A0F2E"/>
            <circle cx="317" cy="88" r="3" fill="#64FFDA"/>
            <!-- Antennae -->
            <g class="antenna">
              <path d="M 320 70 Q 310 50 300 45" stroke="#64FFDA" stroke-width="2" fill="none" stroke-linecap="round"/>
              <circle cx="300" cy="45" r="4" fill="#B084CC"/>
            </g>
            <g class="antenna">
              <path d="M 330 70 Q 340 50 350 45" stroke="#64FFDA" stroke-width="2" fill="none" stroke-linecap="round"/>
              <circle cx="350" cy="45" r="4" fill="#B084CC"/>
            </g>
          </g>
          
          <!-- Legs -->
          <g class="legs" opacity="0.7">
            <line x1="95" y1="118" x2="90" y2="132" stroke="#1A0F2E" stroke-width="2" stroke-linecap="round"/>
            <line x1="130" y1="118" x2="125" y2="132" stroke="#1A0F2E" stroke-width="2" stroke-linecap="round"/>
            <line x1="165" y1="118" x2="160" y2="132" stroke="#1A0F2E" stroke-width="2" stroke-linecap="round"/>
            <line x1="200" y1="118" x2="195" y2="132" stroke="#1A0F2E" stroke-width="2" stroke-linecap="round"/>
            <line x1="235" y1="118" x2="230" y2="132" stroke="#1A0F2E" stroke-width="2" stroke-linecap="round"/>
            <line x1="270" y1="118" x2="265" y2="132" stroke="#1A0F2E" stroke-width="2" stroke-linecap="round"/>
          </g>
        </g>
      </svg>
    </div>
    
    <!-- Silk Spinner -->
    <svg class="silk-spinner" id="silkSpinner" viewBox="0 0 200 200">
      <defs>
        <radialGradient id="silkRadial">
          <stop offset="0%" stop-color="#64FFDA" stop-opacity="0.6"/>
          <stop offset="100%" stop-color="#B084CC" stop-opacity="0"/>
        </radialGradient>
      </defs>
      
      <!-- Silk Threads -->
      <path class="silk-thread" d="M 100 75 Q 60 40 30 50" stroke="#64FFDA" stroke-width="1" fill="none"/>
      <path class="silk-thread" d="M 100 75 Q 80 30 60 20" stroke="#64FFDA" stroke-width="1" fill="none"/>
      <path class="silk-thread" d="M 100 75 Q 100 20 100 10" stroke="#64FFDA" stroke-width="1" fill="none"/>
      <path class="silk-thread" d="M 100 75 Q 120 30 140 20" stroke="#64FFDA" stroke-width="1" fill="none"/>
      <path class="silk-thread" d="M 100 75 Q 140 40 170 50" stroke="#64FFDA" stroke-width="1" fill="none"/>
      <path class="silk-thread" d="M 100 125 Q 140 160 170 150" stroke="#64FFDA" stroke-width="1" fill="none"/>
      <path class="silk-thread" d="M 100 125 Q 120 170 140 180" stroke="#64FFDA" stroke-width="1" fill="none"/>
      <path class="silk-thread" d="M 100 125 Q 100 180 100 190" stroke="#64FFDA" stroke-width="1" fill="none"/>
      <path class="silk-thread" d="M 100 125 Q 80 170 60 180" stroke="#64FFDA" stroke-width="1" fill="none"/>
      <path class="silk-thread" d="M 100 125 Q 60 160 30 150" stroke="#64FFDA" stroke-width="1" fill="none"/>
      <path class="silk-thread" d="M 75 100 Q 30 100 10 100" stroke="#64FFDA" stroke-width="1" fill="none"/>
      <path class="silk-thread" d="M 125 100 Q 170 100 190 100" stroke="#64FFDA" stroke-width="1" fill="none"/>
      
      <!-- Central Silk Mass -->
      <ellipse class="silk-mass" cx="100" cy="100" rx="0" ry="0" fill="url(#silkRadial)"/>
    </svg>
    
    <!-- 3D Cocoon Container -->
    <div class="cocoon-3d-container" id="cocoon3D">
      <canvas id="cocoon-canvas"></canvas>
      <div class="cocoon-fallback" id="cocoonFallback"></div>
    </div>
    
    <!-- Emergence Particles -->
    <div class="emergence-particles" id="emergenceParticles"></div>
    
    <!-- Status Text -->
    <div class="status-text">
      <p id="statusText">Gathering...</p>
    </div>
    
    <!-- Replay Button -->
    <button class="replay-btn" onclick="replay()">â†» Replay</button>
  </div>

  <!-- Three.js for 3D Cocoon -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
  
  <script>
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ğŸ¬ PHASE ORCHESTRATOR
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    const TIMING = {
      crawl: 3000,
      curl: 1500,
      spin: 2500,
      emerge: 2000
    }
    
    let scene, camera, renderer, cocoonMesh, clock
    let animationId = null
    
    // Initialize background particles
    function initBackgroundParticles() {
      const container = document.getElementById('bgParticles')
      container.innerHTML = ''
      
      for (let i = 0; i < 50; i++) {
        const particle = document.createElement('div')
        particle.className = 'bg-particle'
        particle.style.cssText = `
          left: ${Math.random() * 100}%;
          top: ${Math.random() * 100}%;
          width: ${1 + Math.random() * 2}px;
          height: ${1 + Math.random() * 2}px;
          background: ${i % 3 === 0 ? '#64FFDA' : i % 3 === 1 ? '#B084CC' : '#ffffff'};
          animation-delay: ${Math.random() * 5}s;
          animation-duration: ${3 + Math.random() * 4}s;
        `
        container.appendChild(particle)
      }
    }
    
    // Initialize emergence particles
    function createEmergenceParticles() {
      const container = document.getElementById('emergenceParticles')
      container.innerHTML = ''
      
      for (let i = 0; i < 30; i++) {
        const angle = (i / 30) * Math.PI * 2
        const distance = 80 + Math.random() * 120
        const particle = document.createElement('div')
        particle.className = 'emergence-particle'
        particle.style.cssText = `
          width: ${3 + Math.random() * 5}px;
          height: ${3 + Math.random() * 5}px;
          background: ${i % 2 === 0 ? '#64FFDA' : '#B084CC'};
          box-shadow: 0 0 10px ${i % 2 === 0 ? '#64FFDA' : '#B084CC'};
          left: 50%;
          top: 50%;
          --tx: ${Math.cos(angle) * distance}px;
          --ty: ${Math.sin(angle) * distance * 0.6}px;
          animation-delay: ${Math.random() * 0.5}s;
        `
        container.appendChild(particle)
      }
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ğŸ¥š THREE.JS COCOON
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function initThreeJS() {
      const canvas = document.getElementById('cocoon-canvas')
      const container = document.getElementById('cocoon3D')
      
      try {
        // Scene
        scene = new THREE.Scene()
        
        // Camera
        camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000)
        camera.position.z = 4
        
        // Renderer
        renderer = new THREE.WebGLRenderer({ 
          canvas, 
          antialias: true, 
          alpha: true 
        })
        renderer.setSize(window.innerWidth, window.innerHeight)
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2))
        
        // Create gradient texture
        const gradientCanvas = document.createElement('canvas')
        gradientCanvas.width = 256
        gradientCanvas.height = 256
        const ctx = gradientCanvas.getContext('2d')
        const gradient = ctx.createLinearGradient(0, 0, 0, 256)
        gradient.addColorStop(0, '#B084CC')
        gradient.addColorStop(0.4, '#ffffff')
        gradient.addColorStop(0.8, '#64FFDA')
        gradient.addColorStop(1, '#B084CC')
        ctx.fillStyle = gradient
        ctx.fillRect(0, 0, 256, 256)
        
        const texture = new THREE.CanvasTexture(gradientCanvas)
        
        // Cocoon geometry
        const geometry = new THREE.SphereGeometry(1, 128, 128)
        
        // Material
        const material = new THREE.MeshPhysicalMaterial({
          map: texture,
          metalness: 0.15,
          roughness: 0.08,
          clearcoat: 1,
          clearcoatRoughness: 0.05,
          transparent: true,
          opacity: 1,
          envMapIntensity: 1
        })
        
        // Create mesh
        cocoonMesh = new THREE.Mesh(geometry, material)
        cocoonMesh.scale.set(1, 1.7, 1)
        scene.add(cocoonMesh)
        
        // Inner glow
        const glowGeometry = new THREE.SphereGeometry(0.85, 32, 32)
        const glowMaterial = new THREE.MeshBasicMaterial({
          color: 0x64FFDA,
          transparent: true,
          opacity: 0.15
        })
        const glowMesh = new THREE.Mesh(glowGeometry, glowMaterial)
        glowMesh.scale.set(1, 1.5, 1)
        scene.add(glowMesh)
        
        // Lighting
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.4)
        scene.add(ambientLight)
        
        const directionalLight = new THREE.DirectionalLight(0xffffff, 1)
        directionalLight.position.set(5, 5, 5)
        scene.add(directionalLight)
        
        const purpleLight = new THREE.DirectionalLight(0xB084CC, 0.5)
        purpleLight.position.set(-5, -5, -5)
        scene.add(purpleLight)
        
        const tealLight = new THREE.PointLight(0x64FFDA, 0.8)
        tealLight.position.set(0, 2, 2)
        scene.add(tealLight)
        
        // Clock for animation
        clock = new THREE.Clock()
        
        // Start animation loop
        animate()
        
        // Handle resize
        window.addEventListener('resize', onWindowResize)
        
      } catch (e) {
        console.warn('WebGL not supported, using CSS fallback')
        document.getElementById('cocoonFallback').style.display = 'block'
        canvas.style.display = 'none'
      }
    }
    
    function animate() {
      animationId = requestAnimationFrame(animate)
      
      if (cocoonMesh) {
        const t = clock.getElapsedTime()
        
        // Gentle wobble
        cocoonMesh.rotation.x = Math.sin(t / 4) * 0.15
        cocoonMesh.rotation.y = t * 0.08
        
        // Breathing
        const breathe = 1 + Math.sin(t * 1.2) * 0.025
        cocoonMesh.scale.set(1 * breathe, 1.7 * breathe, 1 * breathe)
        
        // Distortion simulation (vertex displacement)
        const positions = cocoonMesh.geometry.attributes.position
        const time = t * 1.8
        
        for (let i = 0; i < positions.count; i++) {
          const x = positions.getX(i)
          const y = positions.getY(i)
          const z = positions.getZ(i)
          
          const noise = Math.sin(x * 3 + time) * Math.cos(y * 3 + time) * Math.sin(z * 3 + time) * 0.08
          
          const length = Math.sqrt(x * x + y * y + z * z)
          const normalizedX = x / length
          const normalizedY = y / length
          const normalizedZ = z / length
          
          positions.setXYZ(
            i,
            x + normalizedX * noise,
            y + normalizedY * noise,
            z + normalizedZ * noise
          )
        }
        positions.needsUpdate = true
      }
      
      renderer.render(scene, camera)
    }
    
    function onWindowResize() {
      camera.aspect = window.innerWidth / window.innerHeight
      camera.updateProjectionMatrix()
      renderer.setSize(window.innerWidth, window.innerHeight)
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ğŸ¬ PHASE TRANSITIONS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function setPhase(phase) {
      const caterpillar = document.getElementById('caterpillar')
      const silkSpinner = document.getElementById('silkSpinner')
      const cocoon3D = document.getElementById('cocoon3D')
      const particles = document.getElementById('emergenceParticles')
      const statusText = document.getElementById('statusText')
      
      switch(phase) {
        case 'crawling':
          caterpillar.classList.remove('curling', 'hidden')
          silkSpinner.classList.remove('active')
          cocoon3D.classList.remove('visible')
          particles.classList.remove('active')
          statusText.textContent = 'Gathering...'
          break
          
        case 'curling':
          caterpillar.classList.add('curling')
          statusText.textContent = 'Transforming...'
          break
          
        case 'spinning':
          caterpillar.classList.add('hidden')
          silkSpinner.classList.add('active')
          statusText.textContent = 'Weaving...'
          break
          
        case 'emerging':
          silkSpinner.classList.remove('active')
          cocoon3D.classList.add('visible')
          createEmergenceParticles()
          particles.classList.add('active')
          statusText.textContent = 'Emerging...'
          break
          
        case 'complete':
          particles.classList.remove('active')
          statusText.textContent = 'Ready'
          break
      }
    }
    
    function startSequence() {
      setPhase('crawling')
      
      setTimeout(() => setPhase('curling'), TIMING.crawl)
      setTimeout(() => setPhase('spinning'), TIMING.crawl + TIMING.curl)
      setTimeout(() => setPhase('emerging'), TIMING.crawl + TIMING.curl + TIMING.spin)
      setTimeout(() => setPhase('complete'), TIMING.crawl + TIMING.curl + TIMING.spin + TIMING.emerge)
    }
    
    function replay() {
      // Reset Three.js mesh
      if (cocoonMesh) {
        const geometry = new THREE.SphereGeometry(1, 128, 128)
        cocoonMesh.geometry.dispose()
        cocoonMesh.geometry = geometry
      }
      
      startSequence()
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ğŸš€ INITIALIZE
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    document.addEventListener('DOMContentLoaded', () => {
      initBackgroundParticles()
      initThreeJS()
      startSequence()
    })
  </script>
</body>
</html>
